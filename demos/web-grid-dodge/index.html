<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meteor Dodge - Sengoo Level Demo</title>
  <style>
    :root {
      --bg-a: #061322;
      --bg-b: #0f253f;
      --panel: #0c1a2e;
      --ink: #edf5ff;
      --muted: #a7bad3;
      --accent: #3fd0ff;
      --danger: #ff6b5a;
      --ok: #31d28f;
      --grid: rgba(255, 255, 255, 0.09);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Trebuchet MS", "Segoe UI", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(1200px 600px at -10% -20%, #1b3f66 0%, transparent 60%),
        radial-gradient(1200px 600px at 110% 10%, #17335a 0%, transparent 60%),
        linear-gradient(140deg, var(--bg-a), var(--bg-b));
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 18px;
    }

    .shell {
      width: min(980px, 100%);
      display: grid;
      grid-template-columns: 360px 1fr;
      gap: 16px;
    }

    .card {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01));
      border: 1px solid rgba(255, 255, 255, 0.14);
      border-radius: 16px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.28);
      backdrop-filter: blur(4px);
    }

    .left {
      padding: 18px;
    }

    h1 {
      margin: 0;
      font-size: 30px;
      letter-spacing: 0.4px;
    }

    .sub {
      margin: 6px 0 12px;
      color: var(--muted);
      line-height: 1.45;
      font-size: 14px;
    }

    .pill {
      display: inline-block;
      font-size: 12px;
      color: #d8f8ff;
      background: rgba(63, 208, 255, 0.15);
      border: 1px solid rgba(63, 208, 255, 0.45);
      border-radius: 999px;
      padding: 6px 10px;
      margin-bottom: 10px;
    }

    .stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 14px 0;
    }

    .stat {
      padding: 10px;
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.18);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .label {
      color: var(--muted);
      font-size: 12px;
      margin-bottom: 4px;
    }

    .value {
      font-size: 21px;
      font-weight: 700;
      letter-spacing: 0.2px;
    }

    .actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    button {
      cursor: pointer;
      border: 0;
      border-radius: 10px;
      padding: 9px 14px;
      font-size: 14px;
      color: #041322;
      background: var(--accent);
      font-weight: 700;
    }

    .danger {
      background: #ff998f;
    }

    .hint {
      margin-top: 12px;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.55;
    }

    .right {
      padding: 12px;
      display: grid;
      gap: 10px;
      align-content: start;
    }

    .canvas-wrap {
      padding: 8px;
      border-radius: 14px;
      background: #06111d;
      border: 1px solid rgba(255, 255, 255, 0.14);
    }

    canvas {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 10px;
      image-rendering: pixelated;
    }

    .touch {
      display: none;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .touch button {
      width: 100%;
      padding: 12px;
    }

    @media (max-width: 900px) {
      .shell {
        grid-template-columns: 1fr;
      }
      .touch {
        display: grid;
      }
    }
  </style>
</head>
<body>
  <div class="shell">
    <aside class="card left">
      <div class="pill">Level Generated by Sengoo</div>
      <h1>Meteor Dodge</h1>
      <p class="sub">Use keyboard or touch buttons to dodge falling meteors. The obstacle sequence comes from <code>level_generator.sg</code>.</p>

      <div class="stats">
        <div class="stat">
          <div class="label">Score</div>
          <div class="value" id="score">0</div>
        </div>
        <div class="stat">
          <div class="label">Best</div>
          <div class="value" id="best">0</div>
        </div>
        <div class="stat">
          <div class="label">Tick</div>
          <div class="value" id="tick">0</div>
        </div>
        <div class="stat">
          <div class="label">State</div>
          <div class="value" id="state">Ready</div>
        </div>
      </div>

      <div class="actions">
        <button id="startBtn">Start</button>
        <button id="restartBtn" class="danger">Restart</button>
      </div>

      <p class="hint">
        Controls: <code>Left / Right</code>, <code>A / D</code>.<br />
        To regenerate level data: run <code>python generate_level.py</code>.
      </p>
    </aside>

    <main class="card right">
      <div class="canvas-wrap">
        <canvas id="game" width="540" height="840"></canvas>
      </div>
      <div class="touch">
        <button id="leftBtn">Move Left</button>
        <button id="rightBtn">Move Right</button>
      </div>
    </main>
  </div>

  <script src="./level_data.js"></script>
  <script>
    (() => {
      const cfg = window.SENGOO_LEVEL || {
        width: 9,
        visible_rows: 14,
        start_col: 4,
        obstacle_cols: [4, 2, 5, 1, 6, 3, 7, 2, 4, 1, 5, 3]
      };

      const canvas = document.getElementById("game");
      const ctx = canvas.getContext("2d");

      const W = cfg.width;
      const H = cfg.visible_rows;
      const CW = canvas.width / W;
      const CH = canvas.height / H;

      let playerCol = cfg.start_col | 0;
      let tick = 0;
      let score = 0;
      let best = 0;
      let running = false;
      let timer = null;
      let idx = 0;
      let obstacles = [];

      const scoreEl = document.getElementById("score");
      const bestEl = document.getElementById("best");
      const tickEl = document.getElementById("tick");
      const stateEl = document.getElementById("state");

      function setState(s) {
        stateEl.textContent = s;
      }

      function resetGame() {
        playerCol = cfg.start_col | 0;
        tick = 0;
        score = 0;
        idx = 0;
        obstacles = [];
        updateStats();
        setState("Ready");
        render();
      }

      function updateStats() {
        scoreEl.textContent = String(score);
        bestEl.textContent = String(best);
        tickEl.textContent = String(tick);
      }

      function spawnObstacle() {
        if (!cfg.obstacle_cols.length) return;
        const col = cfg.obstacle_cols[idx % cfg.obstacle_cols.length];
        idx += 1;
        obstacles.push({ r: 0, c: col | 0 });
      }

      function step() {
        tick += 1;
        score += 1;

        for (const o of obstacles) {
          o.r += 1;
        }
        obstacles = obstacles.filter(o => o.r < H);
        spawnObstacle();

        const hit = obstacles.some(o => o.r === H - 1 && o.c === playerCol);
        if (hit) {
          running = false;
          clearInterval(timer);
          timer = null;
          best = Math.max(best, score);
          updateStats();
          setState("Crashed");
          render(true);
          return;
        }

        best = Math.max(best, score);
        updateStats();
        render(false);
      }

      function start() {
        if (running) return;
        running = true;
        setState("Running");
        if (!timer) {
          timer = setInterval(step, 110);
        }
      }

      function restart() {
        if (timer) {
          clearInterval(timer);
          timer = null;
        }
        running = false;
        resetGame();
      }

      function move(delta) {
        if (!running) return;
        playerCol = Math.max(0, Math.min(W - 1, playerCol + delta));
        render(false);
      }

      function render(crashed = false) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = "#04111f";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.strokeStyle = "rgba(255,255,255,0.10)";
        ctx.lineWidth = 1;
        for (let x = 0; x <= W; x += 1) {
          ctx.beginPath();
          ctx.moveTo(x * CW, 0);
          ctx.lineTo(x * CW, canvas.height);
          ctx.stroke();
        }
        for (let y = 0; y <= H; y += 1) {
          ctx.beginPath();
          ctx.moveTo(0, y * CH);
          ctx.lineTo(canvas.width, y * CH);
          ctx.stroke();
        }

        for (const o of obstacles) {
          const x = o.c * CW;
          const y = o.r * CH;
          ctx.fillStyle = "#ff6b5a";
          ctx.fillRect(x + 4, y + 4, CW - 8, CH - 8);
        }

        const px = playerCol * CW;
        const py = (H - 1) * CH;
        ctx.fillStyle = crashed ? "#ffb3ab" : "#3fd0ff";
        ctx.fillRect(px + 4, py + 4, CW - 8, CH - 8);
      }

      document.getElementById("startBtn").addEventListener("click", start);
      document.getElementById("restartBtn").addEventListener("click", restart);
      document.getElementById("leftBtn").addEventListener("click", () => move(-1));
      document.getElementById("rightBtn").addEventListener("click", () => move(1));

      window.addEventListener("keydown", (e) => {
        if (e.key === "ArrowLeft" || e.key === "a" || e.key === "A") move(-1);
        if (e.key === "ArrowRight" || e.key === "d" || e.key === "D") move(1);
        if (e.key === " " && !running) start();
      });

      resetGame();
    })();
  </script>
</body>
</html>
