# Sengoo Bench

Independent benchmark and verification repository for Sengoo.

This repo is designed for one purpose: **measure performance and correctness trends with reproducible scripts**.

## What This Repository Covers

- Cross-language performance matrix (Sengoo vs C++ vs Rust vs Python)
- Real incremental compile scenarios (loop-body change, signature change, add function)
- Scale curve (1k / 10k / 100k / 1000k LOC)
- Link-share and phase split analysis
- Compile peak-memory comparison (RSS/private, 10k/100k/1000k LOC)
- Python interoperability benchmark (Sengoo Runtime / Rust PyO3 / C++ CPython API / Python native)
- Non-invasive reflection benchmark (disabled vs enabled-unused vs enabled-used)
- Bootstrap generality proof (multi-capability correctness + latency)
- CI gate scripts (soft/hard) for KPI enforcement
- E2E smoke scripts for baseline toolchain health
- Developer demos (hot-path proof and web mini game)

## Repository Layout

```text
bench/
|-- scripts/                       # perf/e2e/gate automation scripts
|-- suites/                        # suite assets and generated inputs
|-- tests/                         # sample programs and runnable examples
|   `-- python_interop_example.py  # direct Python interop example (new)
|-- demos/                         # developer-facing demos
|   |-- hotpath-risk-scoring/      # Sengoo vs Python practical hotspot demo
|   `-- web-grid-dodge/            # web mini game with Sengoo-generated level
|-- results/                       # generated JSON reports (ignored by git)
|-- advanced_pipeline_bench.py
|-- scenario_matrix_bench.py
|-- python_interop_bench.py
|-- noninvasive_reflection_bench.py
|-- bootstrap_generality_bench.py
`-- README.md
```

## Prerequisites

Required:

- Python 3.10+
- Rust toolchain (`cargo`, `rustc`)
- Sengoo source tree available (set via `SENGOO_ROOT` or sibling layout)

Optional but recommended for full comparability:

- LLVM/Clang (`clang`, `clang++`)
- C++ toolchain runtime environment

## Clone and Reproduce (From Scratch)

### Option A: Sibling layout (recommended)

```bash
# parent dir can be any workspace root
cd /path/to/workspace
git clone https://github.com/Hyper66666/Sengoo.git
git clone https://github.com/Hyper66666/bench.git

# enter bench repo
cd bench
```

```powershell
Set-Location C:\path\to\workspace
git clone https://github.com/Hyper66666/Sengoo.git
git clone https://github.com/Hyper66666/bench.git
Set-Location .\bench
```

### Option B: Bench is not next to Sengoo

Set `SENGOO_ROOT` explicitly:

```bash
export SENGOO_ROOT=/absolute/path/to/Sengoo
```

```powershell
$env:SENGOO_ROOT = "C:\absolute\path\to\Sengoo"
```

### Environment check

```bash
python --version
cargo --version
clang --version
```

```powershell
python --version
cargo --version
clang --version
```

If `clang` is missing, C++-related runners may be skipped (interop benchmark still produces output for available runners).

## Standard Test Flow

Run from `bench/` root.

### 1) Toolchain smoke (fast sanity)

```bash
bash ./scripts/e2e-smoke.sh
```

```powershell
powershell -File .\scripts\e2e-smoke.ps1
```

This verifies:

- `sgc check` works
- LLVM IR emit works
- daemon happy-path works
- daemon fallback path works

## Developer Demos

```bash
# Practical hotspot proof (Sengoo vs Python)
python ./demos/hotpath-risk-scoring/run_demo.py

# Reflection ergonomics proof (Sengoo auto reflection vs C++ manual registry)
python ./demos/reflection-auto-vs-cpp/run_demo.py

# Web mini game level generated by Sengoo
python ./demos/web-grid-dodge/generate_level.py
python ./demos/web-grid-dodge/serve.py --port 8088
```

### 2) Direct Python interop example (new)

This is a ready-to-run example under `tests/` that directly prints summary output:

```bash
python ./tests/python_interop_example.py
```

```powershell
python .\tests\python_interop_example.py
```

Optional quick tuning:

```bash
python ./tests/python_interop_example.py --calls 3000 --samples 2 --warmup 0
```

```powershell
python .\tests\python_interop_example.py --calls 3000 --samples 2 --warmup 0
```

The script:

- invokes `python_interop_bench.py`
- auto-detects the generated JSON report path
- prints a compact table (`loop_avg_ms`, `calls_per_sec`, `vs_python_native_pct`)

### 3) Core benchmark suites

```bash
python ./scenario_matrix_bench.py
python ./advanced_pipeline_bench.py
python ./python_interop_bench.py
python ./noninvasive_reflection_bench.py
python ./bootstrap_generality_bench.py
```

```powershell
python .\scenario_matrix_bench.py
python .\advanced_pipeline_bench.py
python .\python_interop_bench.py
python .\noninvasive_reflection_bench.py
python .\bootstrap_generality_bench.py
```

### 4) Gate checks (soft/hard)

Advanced KPI gate:

```bash
python ./scripts/advanced-kpi-gate.py \
  --mode soft \
  --sample ./results/<advanced-report>.json \
  --baseline-profile ./frontend-memory-baseline.json
```

Interop + bootstrap gate:

```bash
python ./scripts/interop-bootstrap-gate.py \
  --mode soft \
  --interop-sample ./results/<python-interop-report>.json \
  --bootstrap-sample ./results/<bootstrap-report>.json
```

PowerShell:

```powershell
python .\scripts\advanced-kpi-gate.py --mode soft --sample .\results\<advanced-report>.json --baseline-profile .\frontend-memory-baseline.json
python .\scripts\interop-bootstrap-gate.py --mode soft --interop-sample .\results\<python-interop-report>.json --bootstrap-sample .\results\<bootstrap-report>.json
```

Rollback helper (gate fail -> force legacy mode override):

```bash
python ./scripts/frontend-memory-rollback.py \
  --decision ./results/<advanced-report>-advanced-gate.json
```

## Output Files and How to Read Them

Reports are written to `results/`:

- `*-scenario-matrix.json`
  - 5-scenario runtime/full/incremental matrix across 4 languages
- `*-advanced-pipeline.json`
  - real incremental edits + scale curve + link share + reachability matrix + compile-memory comparison
  - includes `rollback_evidence` block (baseline id + thresholds + decision-ready comparisons)
- `*-advanced-gate.json`
  - generated by `advanced-kpi-gate.py`; contains pass/fail decision, baseline reference, thresholds, and comparison details
- `*-python-interop.json`
  - Python boundary overhead and throughput comparison
- `*-noninvasive-reflection-bench.json`
  - non-invasive reflection overhead summary and threshold checks
- `*-bootstrap-generality.json`
  - capability coverage + correctness proof status

Quick interpretation checklist:

- Runtime competitiveness: compare `runtime_p50_avg_ms`
- Compile throughput: compare `full_compile_avg_ms`
- Incremental effectiveness: inspect `incremental_reduction_avg_pct`
- 100k scale bottleneck: check `scale_curve/100000/*`
- 1000k scale trend: check `scale_curve/1000000/*`
- Compile memory trend: check `compile_memory_compare/10000|100000|1000000/*/peak_rss_mb_avg`
- Python boundary cost: check `summary/ordered_by_loop_avg_ms`

## Latest Snapshot (Measured on February 18, 2026)

Source reports:

- `results/1771185238357-scenario-matrix.json`
- `results/1771390773767-advanced-pipeline.json`
- `results/1771392747911-advanced-pipeline.json`
- `results/1771230408116-python-interop.json`
- `results/1771230417893-bootstrap-generality.json`

Highlights:

- Scenario matrix incremental reduction avg:
  - Sengoo: `95.99%`
  - C++: `-2.28%`
  - Rust: `-4.95%`
  - Python: `2.61%`
- Advanced pipeline 100k e2e (Sengoo, 2-run avg): `417.53ms`
- Advanced pipeline 1000k e2e (Sengoo, 2-run avg): `1827.84ms`
- Python interop loop avg (ms):
  - Python native: `2.184`
  - Sengoo Runtime: `2.665`
  - C++ CPython API: `2.919`
  - Rust PyO3: `2.930`
- Bootstrap proof: `pass` (`6/6` scenarios passed)

Two-run average (Sengoo vs C++, e2e + compile RSS):

| LOC | Sengoo e2e (ms) | C++ e2e (ms) | Sengoo/C++ e2e | Sengoo RSS (MB) | C++ RSS (MB) | Sengoo/C++ RSS |
|---:|---:|---:|---:|---:|---:|---:|
| 10k | 372.28 | 693.01 | x0.54 | 18.88 | 75.68 | x0.25 |
| 100k | 417.53 | 1074.84 | x0.39 | 140.18 | 118.50 | x1.18 |
| 1000k | 1827.84 | 4883.70 | x0.37 | 1367.99 | 435.22 | x3.14 |

Compile peak memory comparison (RSS MB, lower is better; compile-stage only, 2-run avg):

| LOC | Sengoo | C++ | Rust | Python |
|---:|---:|---:|---:|---:|
| 10k | 18.88 | 75.68 | 70.84 | 41.40 |
| 100k | 140.18 | 118.50 | 337.86 | 288.46 |
| 1000k | 1367.99 | 435.22 | 2681.55 | 2610.90 |

Compile peak private memory (MB, when supported by OS, 2-run avg):

| LOC | Sengoo | C++ | Rust | Python |
|---:|---:|---:|---:|---:|
| 10k | 14.91 | 41.68 | 127.44 | 35.59 |
| 100k | 142.74 | 85.75 | 409.79 | 294.55 |
| 1000k | 1399.36 | 430.48 | 2998.37 | 2718.77 |

## CI Gate Mapping

- `scripts/advanced-kpi-gate.py`
  - enforces real incremental + scale + stage budgets + Sengoo RSS memory budgets
  - enforces baseline regression checks for frontend time/RSS at `100k` and `1000k`
- `scripts/frontend-memory-rollback.py`
  - converts failed gate decision into `SENGOO_FRONTEND_MEMORY_MODE=legacy` override artifact
- `scripts/interop-bootstrap-gate.py`
  - enforces interop competitiveness + bootstrap generality pass
- `scripts/e2e-smoke.sh` / `scripts/e2e-smoke.ps1`
  - validates baseline compile pipeline behavior

Use `--mode hard` in CI to fail the workflow when thresholds are violated.

## Troubleshooting

- `cannot resolve Sengoo source root`
  - set `SENGOO_ROOT` explicitly.
- `clang++ not found`
  - install LLVM/Clang or expect C++ runner to be skipped.
- cargo network failures
  - script will try offline build fallback when applicable.
- large variance in local timings
  - close background heavy processes and repeat with more samples.

---

## 涓枃鐗?
# Sengoo Bench锛堜腑鏂囪鏄庯級

杩欐槸 Sengoo 鐨勭嫭绔嬪熀鍑嗕笌楠岃瘉浠撳簱锛岀洰鏍囨槸璁╂€ц兘/姝ｇ‘鎬ф暟鎹?*鍙鐜般€佸彲瀵规瘮銆佸彲杩?CI gate**銆?
## 杩欎釜浠撳簱鑳藉仛浠€涔?
- 鍥涜瑷€瀵规瘮锛圫engoo / C++ / Rust / Python锛?- 鐪熷疄澧為噺鍦烘櫙锛堟敼寰幆浣撱€佹敼鍑芥暟绛惧悕銆佸姞鏂板嚱鏁帮級
- 瑙勬ā鏇茬嚎锛?k / 10k / 100k / 1000k LOC锛?- 閾炬帴鍗犳瘮涓庨樁娈垫媶鍒嗗垎鏋?- Python 浜掓搷浣滃熀鍑嗭紙Sengoo Runtime / Rust PyO3 / C++ CPython API / Python 鍘熺敓锛?- Bootstrap 閫氱敤鎬ц瘉鏄庯紙澶氳兘鍔涜鐩?+ 姝ｇ‘鎬э級
- 杞?纭棬绂佽剼鏈紙CI 鍙洿鎺ユ帴鍏ワ級
- 绔埌绔?smoke 鑴氭湰锛堝伐鍏烽摼鍋ュ悍妫€鏌ワ級

## 鐩綍缁撴瀯

```text
bench/
|-- scripts/                       # perf/e2e/gate 鑴氭湰
|-- suites/                        # 鍩哄噯濂椾欢璧勬簮
|-- tests/                         # 绀轰緥涓庡彲鐩存帴杩愯鑴氭湰
|   `-- python_interop_example.py  # Python 浜掓搷浣滅洿鎺ョず渚嬶紙鏂板锛?|-- results/                       # 缁撴灉 JSON锛坓it 蹇界暐锛?|-- scenario_matrix_bench.py
|-- advanced_pipeline_bench.py
|-- python_interop_bench.py
|-- bootstrap_generality_bench.py
`-- README.md
```

## 渚濊禆瑕佹眰

蹇呴渶锛?
- Python 3.10+
- Rust 宸ュ叿閾撅紙`cargo` / `rustc`锛?- 鍙闂?Sengoo 婧愮爜鐩綍锛堥€氳繃 `SENGOO_ROOT` 鎴栧悓绾х洰褰曪級

寤鸿锛堢敤浜庡畬鏁村姣旓級锛?
- LLVM/Clang锛坄clang` / `clang++`锛?- C++ 杩愯鐜

## clone 鍚庡浣曞鐜?
### 鎺ㄨ崘鏂瑰紡锛氬悓绾х洰褰?
```bash
cd /path/to/workspace
git clone https://github.com/Hyper66666/Sengoo.git
git clone https://github.com/Hyper66666/bench.git
cd bench
```

PowerShell:

```powershell
Set-Location C:\path\to\workspace
git clone https://github.com/Hyper66666/Sengoo.git
git clone https://github.com/Hyper66666/bench.git
Set-Location .\bench
```

### 闈炲悓绾х洰褰?
鎵嬪姩璁剧疆 `SENGOO_ROOT`锛?
```bash
export SENGOO_ROOT=/absolute/path/to/Sengoo
```

```powershell
$env:SENGOO_ROOT = "C:\absolute\path\to\Sengoo"
```

### 鐜妫€鏌?
```bash
python --version
cargo --version
clang --version
```

## 鎺ㄨ崘娴嬭瘯娴佺▼

### 1锛夊厛璺?smoke锛堝揩閫熺‘璁ょ幆澧冿級

```bash
bash ./scripts/e2e-smoke.sh
```

```powershell
powershell -File .\scripts\e2e-smoke.ps1
```

### 2锛夎繍琛屾柊澧?Python 浜掓搷浣滅ず渚嬶紙鍙洿鎺ュ嚭缁撴灉锛?
```bash
python ./tests/python_interop_example.py
```

```powershell
python .\tests\python_interop_example.py
```

蹇€熷弬鏁帮細

```bash
python ./tests/python_interop_example.py --calls 3000 --samples 2 --warmup 0
```

璇ヨ剼鏈細鑷姩锛?
- 璋冪敤 `python_interop_bench.py`
- 璇嗗埆鏈鐢熸垚鐨?JSON 鎶ュ憡璺緞
- 杈撳嚭绮剧畝缁撴灉琛紙`loop_avg_ms`銆乣calls_per_sec`銆乣vs_python_native_pct`锛?
### 3锛夎窇瀹屾暣鏍稿績鍩哄噯

```bash
python ./scenario_matrix_bench.py
python ./advanced_pipeline_bench.py
python ./python_interop_bench.py
python ./bootstrap_generality_bench.py
```

### 4锛夋墽琛?gate

```bash
python ./scripts/advanced-kpi-gate.py --mode soft --sample ./results/<advanced-report>.json
python ./scripts/interop-bootstrap-gate.py --mode soft --interop-sample ./results/<python-interop-report>.json --bootstrap-sample ./results/<bootstrap-report>.json
```

## 缁撴灉鎬庝箞鐪?
杈撳嚭閮藉湪 `results/`锛?
- `*-scenario-matrix.json`锛氶€氱敤鍦烘櫙鍥涜瑷€鐭╅樀
- `*-advanced-pipeline.json`锛氱湡瀹炲閲?+ 瑙勬ā鏇茬嚎 + 閾炬帴鍗犳瘮
- `*-python-interop.json`锛歅ython 杈圭晫寮€閿€涓庡悶鍚?- `*-bootstrap-generality.json`锛氳兘鍔涜鐩栧拰姝ｇ‘鎬ц瘉鏄?
蹇€熷叧娉ㄧ偣锛?
- 杩愯鏃讹細`runtime_p50_avg_ms`
- 鍏ㄩ噺缂栬瘧锛歚full_compile_avg_ms`
- 澧為噺鏀剁泭锛歚incremental_reduction_avg_pct`
- 100k 鐡堕锛歚scale_curve/100000/*`
- 1000k 瓒嬪娍锛歚scale_curve/1000000/*`
- 浜掓搷浣滆竟鐣岋細`summary/ordered_by_loop_avg_ms`

## 鏈€鏂板揩鐓э紙2026-02-16锛?
瀵瑰簲鏂囦欢锛?
- `results/1771185238357-scenario-matrix.json`
- `results/1771246902505-advanced-pipeline.json`
- `results/1771230408116-python-interop.json`
- `results/1771230417893-bootstrap-generality.json`

鍏抽敭鏁版嵁锛?
- 澧為噺骞冲潎鏀剁泭锛歋engoo `95.99%`
- 100k 绔埌绔細Sengoo `417.53ms`
- 1000k 绔埌绔細Sengoo `1827.84ms`
- 浜掓搷浣?loop 骞冲潎锛歋engoo Runtime `2.665ms`
- Bootstrap锛歚pass`锛坄6/6`锛?
## 甯歌闂

- `cannot resolve Sengoo source root`
  - 璁剧疆 `SENGOO_ROOT`銆?- `clang++ not found`
  - 瀹夎 Clang锛屾垨鎺ュ彈 C++ runner 琚烦杩囥€?- cargo 涓嬭浇澶辫触
  - 鑴氭湰浼氬敖閲忚蛋 offline fallback銆?- 鏈湴娉㈠姩澶?  - 鍏抽棴楂樿礋杞借繘绋嬪苟澧炲姞閲囨牱娆℃暟銆?
